!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Calendula=e()}(this,function(){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function e(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function f(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function u(t){return"string"==typeof t}function h(t){return"number"==typeof t}function c(t){return void 0===t}function d(t){var e={top:0,left:0};return t&&!c(t.getBoundingClientRect)&&(e=t.getBoundingClientRect()),{top:e.top+(window.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:e.left+(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}}function y(t,e){var n=e.left,i=e.top;t.style.left=h(n)?n+"px":n,t.style.top=h(i)?i+"px":i}function m(t,e){t.style.transform="translateY("+(h(e)?e+"px":e)+")"}var v=[["left","bottom"],["left","top"],["right","bottom"],["right","top"],["center","bottom"],["center","top"]];function p(t,e,n,i){return e<=n||i<=t?0:Math.min(e,i)-Math.max(t,n)}function _(t,e){var n={x1:t.left,y1:t.top,x2:t.left+e.offsetWidth,y2:t.top+e.offsetHeight},i=function(){var t=document.documentElement,e=window.pageXOffset,n=window.pageYOffset;return{x1:e,y1:n,x2:e+t.clientWidth,y2:n+t.clientHeight}}();return p(n.x1,n.x2,i.x1,i.x2)*p(n.y1,n.y2,i.y1,i.y2)}function g(t){return"auto"===t||c(t)}function b(t,e,n){var i=d(n),o=i.left,r=i.top;if(u(t.left))switch(t.left){case"center":o+=(n.offsetWidth-e.offsetWidth)/2;break;case"right":o+=n.offsetWidth-e.offsetWidth}if(u(t.top))switch(t.top){case"top":r-=e.offsetHeight;break;case"center":r-=(e.offsetHeight-n.offsetHeight)/2;break;case"bottom":r+=n.offsetHeight}return{left:o,top:r}}function k(t){return(t<10?"0":"")+t}function E(t,e,n){return[t,k(e+1),k(n)].join("-")}function x(t){var e,n,i=null;if(t)if(u(t)){if("today"===t)return new Date;(e=/^\s*(\d{4})[-/.](\d\d)(?:[-/.](\d\d))?\s*$/.exec(t))?n=[e[3],e[2],e[1]]:(e=/^\s*(\d{1,2})[-/.](\d{1,2})(?:[-/.](\d{4}|\d\d))?\s*$/.exec(t))&&(n=[e[1],e[2],e[3]]),n&&(i=new Date(parseInt(n[2],10),parseInt(n[1]-1,10),parseInt(n[0],10)))}else!function(t){return"object"===o(t)}(t)?h(t)&&(i=new Date(t)):t instanceof Date?i=t:t.year&&t.day&&(i=new Date(t.year,t.month,t.day,12,0,0,0));return i}function w(t){var e=x(t);return e?[e.getFullYear(),k(e.getMonth()+1),k(e.getDate())].join("-"):null}function M(t){var e=x(t);return e?{day:e.getDate(),month:e.getMonth(),year:e.getFullYear()}:{}}function D(){var t=new Date;return{day:t.getDate(),month:t.getMonth(),year:t.getFullYear()}}var O=27,A=34,S=33,H=function(){function t(){r(this,t),this._events={}}return e(t,[{key:"on",value:function(t,e){return t&&e&&(this._events[t]=this._events[t]||[],this._events[t].push({type:t,callback:e})),this}},{key:"off",value:function(t,e){return this._events[t]&&(this._events[t]=this._events[t].filter(function(t){return e!==t.callback})),this}},{key:"trigger",value:function(e,n){var i=this;return this._events[e]&&this._events[e].forEach(function(t){e===t.type&&t.callback.call(i,{type:e},n)}),this}}]),t}();function C(t,e,n,i){return t+(e?"__"+e:"")+(n?"_"+n+(""===i?"":"_"+i):"")}var t=function(){function t(){return r(this,t),l(this,s(t).apply(this,arguments))}return n(t,H),e(t,[{key:"e",value:function(t,e,n){return null===n||!1===n?e="":!0!==n&&void 0!==n||(n=""),C(this._name,t,e,n)}},{key:"m",value:function(t,e){return null===e||!1===e?t="":!0!==e&&void 0!==e||(e=""),C(this._name,"",t,e)}},{key:"delMod",value:function(e,t){var n=this.getElemName(e),i=n?this.e(n,t):this.m(t);return(e.className||"").split(" ").forEach(function(t){t!==i&&-1===t.search(i+"_")||e.classList.remove(t)}),this}},{key:"setMod",value:function(t,e,n){var i=this.getElemName(t);return this.delMod(t,e),t.classList.add(i?this.e(i,e,n):this.m(e,n)),this}},{key:"hasMod",value:function(t,e,n){var i=this.getElemName(t);return t.classList.contains(i?this.e(i,e,n):this.m(e,n))}},{key:"hasElem",value:function(t,e){return t.classList.contains(this.e(e))}},{key:"getElemName",value:function(t){var e=t.className.match(/__([^ _$]+)/);return e?e[1]:""}},{key:"findElem",value:function(t,e,n){return this._dom.querySelector("."+this.e(t,e,n))}},{key:"findElemContext",value:function(t,e,n,i){return t.querySelector("."+this.e(e,n,i))}},{key:"findElemAll",value:function(t,e,n){return this._dom.querySelectorAll("."+this.e(t,e,n))}},{key:"findElemAllContext",value:function(t,e,n,i){return t.querySelectorAll("."+this.e(e,n,i))}}]),t}(),T=function(){function o(t){var e;r(this,o),e=l(this,s(o).call(this,t));var n=o.extend({},t||{}),i=e._prepareYears(n.years);return e.params=o.extend(n,{autocloseable:!!c(n.autocloseable)||n.autocloseable,closeAfterSelection:!!c(n.closeAfterSelection)||n.closeAfterSelection,locale:n.locale||"en",max:M(n.max),min:M(n.min),maxColor:n.maxColor||5,showOn:n.showOn||"click",theme:n.theme||"default",startYear:i.start,endYear:i.end}),e._name="calendula",e._initExtensions(),e.val(e.setting("value")),e._addSwitcherEvents(e.setting("showOn")),e}return n(o,t),e(o,[{key:"isOpened",value:function(){return this._isOpened}},{key:"open",value:function(){var t=this;return this._init(),this.isOpened()||(this.timeout.clearAll(["open","close"]).set(function(){t.setMod(t._dom,"opened",!0),t._update(),t._monthSelector(t._currentDate.month,!1),t._yearSelector(t._currentDate.year,!1),t._openedEvents()},0,"open"),this._isOpened=!0,this.trigger("open")),this}},{key:"close",value:function(){var t=this;return this._init(),this.isOpened()&&(this.timeout.clearAll(["open","close"]).set(function(){t.timeout.clearAll("open"),t._update(),t._delOpenedEvents(),t.delMod(t._dom,"opened"),t.tooltip.hide(),t.trigger("close")},0,"close"),this._isOpened=!1),this}},{key:"toggle",value:function(){return this.isOpened()?this.close():this.open()}},{key:"val",value:function(t){if(!arguments.length)return this._val;t?(this._val=M(t),this._currentDate=o.extend({},this._val)):(this._val={},this._currentDate=D()),this._dom&&this._updateSelection(),this._updateSwitcher()}},{key:"setting",value:function(t,e){var n=this._dom;return 1===arguments.length?this.params[t]:(this.params[t]=-1<["min","max","value"].indexOf(t)?M(e):e,"showOn"===t&&this._addSwitcherEvents(e),n&&("theme"===t?this.setMod(n,"theme",e):"daysAfterMonths"===t&&(e?this.setMod(n,"days-after-months"):this.delMod(n,"days-after-months")),"position"===t&&this.isOpened()&&this._position(e),{min:!0,max:!0,locale:!0}[t]&&this._rebuild()),this)}},{key:"destroy",value:function(){this._isInited&&(delete this._events,this.close(),this._destroyExtensions(),document.body.removeChild(this._dom),this.params=null,this._dom=null,this._isInited=null)}},{key:"_init",value:function(){if(!this._isInited){this._isInited=!0;var t=this.setting("id"),e=document.createElement("div");e.className=this._name,t&&(e.id=t),this._dom=e,this.setMod(e,"theme",this.setting("theme")),this.setting("daysAfterMonths")&&this.setMod(e,"days-after-months"),this._rebuild(),document.body.appendChild(e)}}},{key:"_position",value:function(t){var e=f((t||"").split(" "),2),n=e[0],i=e[1],o=this.setting("switcher"),r={left:n,top:i};o&&(g(r.left)||g(r.top))&&(r=function(r,s,a){var l=g(r.left),u=g(r.top),h=-1,c=0;v.forEach(function(t,e){var n=t[0],i=t[1];if(l&&u||l&&i===r.top||u&&n===r.left){var o=_(b(r,s,a),s);h<o&&(h=o,c=e)}});var t=f(v[c],2);return{left:t[0],top:t[1]}}(r,this._dom,o)),y(this._dom,b(r,this._dom,o))}},{key:"_update",value:function(){this._init(),this._position(this.setting("position"))}},{key:"_findDayByDate",value:function(t){if(t.year!==this._currentDate.year)return null;var e=this.findElemAll("days-month")[t.month];return e&&this.findElemAllContext(e,"day")[t.day-1]||null}},{key:"_onresize",value:function(){this._update()}},{key:"_onscroll",value:function(){this._update()}},{key:"_rebuild",value:function(){var t=this.isOpened();t&&this._delOpenedEvents(),this._dom.innerHTML=this.template.get("main"),t&&(this._openedEvents(),this._monthSelector(this._currentDate.month,!1),this._yearSelector(this._currentDate.year,!1))}},{key:"_rebuildDays",value:function(){this.findElem("days-container").innerHTML=this.template.get("days"),this._monthSelector(this._currentDate.month,!1)}},{key:"_intoContainer",value:function(t){for(var e=t;e;){if(e===this._dom)return!0;e=e.parentNode}return!1}},{key:"_openedEvents",value:function(){var s=this;this.domEvent.on(document,"click",function(t){!t.button&&s.setting("autocloseable")&&(t.target===s.setting("switcher")||s._intoContainer(t.target)||s.close())},"open"),this.domEvent.on(window,"resize",function(){s._onresize()},"open").on(document,"scroll",function(){s._onscroll()},"open").on(document,"keypress",function(t){var e=s._currentDate;switch(t.keyCode){case O:s.close();break;case A:t.ctrlKey||t.altKey?s._monthSelector(e.month+1,!0):s._yearSelector(e.year+1,!0),t.preventDefault();break;case S:t.ctrlKey||t.altKey?s._monthSelector(e.month-1,!0):s._yearSelector(e.year-1,!0),t.preventDefault()}},"open").on(this._dom,"click",function(t){t.button||s.tooltip.hide()},"open");var a=this.findElem("days"),t=this.findElem("months"),e=this.findElem("years");this._onwheelmonths=function(t){var e=s._getDeltaY(t);e&&(s._monthSelector(s._currentDate.month+e,!0),t.preventDefault())},this._onwheelyears=function(t){var e=s._getDeltaY(t);e&&(s._yearSelector(s._currentDate.year+e,!0),t.preventDefault())},this.domEvent.on(a,"wheel",this._onwheelmonths,"open").on(t,"wheel",this._onwheelmonths,"open").on(e,"wheel",this._onwheelyears,"open"),this.domEvent.on(t,"click",function(t){t.button||s.hasElem(t.target,"month")&&s._monthSelector(+t.target.dataset.month,!0)},"open"),this.domEvent.on(e,"click",function(t){if(!t.button){var e=t.target.dataset.year;e&&s._yearSelector(+e,!0)}},"open"),this.domEvent.on(a,"mouseover",function(t){var e=t.target,n=+e.dataset.day,i=+e.dataset.month,o=+s._currentDate.year;s.hasElem(e,"day")&&s.hasMod(e,"has-title")&&s.tooltip.show(e,s.title.get(E(o,i,n)))},"open"),this.domEvent.on(a,"mouseout",function(t){s.hasElem(t.target,"day")&&s.tooltip.hide()},"open"),this.domEvent.on(a,"click",function(t){if(!t.button){var e=s._currentDate,n=t.target,i=n.dataset.day,o=n.dataset.month;if(i){if(s.hasMod(n,"minmax"))return;if(!s.hasMod(n,"selected")){e.day=+i,e.month=+o;var r=a.querySelector("."+s.e("day","selected"));r&&s.delMod(r,"selected"),s.setMod(n,"selected"),s.trigger("select",{day:e.day,month:e.month,year:e.year}),s.setting("closeAfterSelection")&&s.close()}}}},"open")}},{key:"_getDeltaY",value:function(t){return 1<=t.deltaY?1:t.deltaY<0?-1:0}},{key:"_monthSelector",value:function(t,e){var n=this;t<0?t=0:11<t&&(t=11),this._currentDate.month=t;var i=this.findElem("months"),o=this.findElem("month").offsetHeight,r=this.findElemAll("days-month")[t],s=this.findElem("month-selector"),a=this.findElem("days-container"),l=this.findElem("days");e||(this.setMod(l,"noanim"),this.setMod(i,"noanim"));var u=Math.floor(this._currentDate.month*o-o/2);u<=0&&(u=1),u+s.offsetHeight>=i.offsetHeight&&(u=i.offsetHeight-s.offsetHeight-1),m(s,u);var h=-Math.floor(r.offsetTop-l.offsetHeight/2+r.offsetHeight/2);0<h&&(h=0);var c=l.offsetHeight-a.offsetHeight;h<c&&(h=c),m(a,h),this._colorizeMonths(t),e||this.timeout.set(function(){n.delMod(l,"noanim"),n.delMod(i,"noanim")},0,"anim")}},{key:"_yearSelector",value:function(t,e){var n=this,i=this.params.startYear,o=this.params.endYear,r=this._currentDate.year;t<i?t=i:o<t&&(t=o),this._currentDate.year=t;var s=this.findElem("years"),a=this.findElem("years-container"),l=this.findElem("year").offsetHeight,u=this.findElem("year-selector");e||this.setMod(s,"noanim");var h=Math.floor((this._currentDate.year-i)*l),c=-Math.floor((this._currentDate.year-i)*l-s.offsetHeight/2);0<c&&(c=0),c<s.offsetHeight-a.offsetHeight&&(c=s.offsetHeight-a.offsetHeight);var f=0;s.offsetHeight>=a.offsetHeight&&((o-i+1)%2&&(f=l),c=Math.floor((s.offsetHeight-a.offsetHeight-f)/2)),t!==r&&this._rebuildDays(t),m(u,h),m(a,c),this._colorizeYears(t),e||this.timeout.set(function(){n.delMod(s,"noanim")},0,"anim")}},{key:"_decolorize",value:function(t){for(var e=0;e<this.setting("maxColor");e++)for(var n=this.findElemAll(t,"color",e),i=0,o=n.length;i<o;i++)this.delMod(n[i],"color",e)}},{key:"_colorizeMonths",value:function(t){var e=this.findElemAll("month");this._decolorize("month"),this.setMod(e[t],"color","0"),0<=t-1&&this.setMod(e[t-1],"color","0"),t+1<=11&&this.setMod(e[t+1],"color","0");for(var n=1,i=t-2;0<=i&&n<this.setting("maxColor");i--,n++)this.setMod(e[i],"color",n);n=1;for(var o=t+2;o<=11&&n<this.setting("maxColor");o++,n++)this.setMod(e[o],"color",n)}},{key:"_colorizeYears",value:function(t){var e=this.findElemAll("year"),n=this.setting("startYear");this._decolorize("year"),this.setMod(e[t-n],"color","0");for(var i=1,o=t-1;n<=o&&i<this.setting("maxColor");o--,i++)this.setMod(e[o-n],"color",i);for(var r=t+(i=1);r<=this.setting("_endYear")&&i<this.setting("maxColor");r++,i++)this.setMod(e[r-n],"color",i)}},{key:"_delOpenedEvents",value:function(){this.domEvent.offAll("open")}},{key:"_prepareYears",value:function(t){var e,n,i,o=D();return u(t)&&(e=t.trim().split(/[:,; ]/),n=parseInt(e[0],10),i=parseInt(e[1],10),isNaN(n)||isNaN(i)||(Math.abs(n)<1e3&&(n=o.year+n),Math.abs(i)<1e3&&(i=o.year+i))),{start:n||o.year-11,end:i||o.year+1}}},{key:"_updateSelection",value:function(){var t=this.findElem("day","selected");if(t&&this.delMod(t,"selected"),this._currentDate.year===this._val.year){var e=this.findElemAll("days-month");if(e&&e[this._val.month]){var n=this.findElemAllContext(e[this._val.month],"day"),i=this._val.day-1;n&&n[i]&&this.setMod(n[i],"selected")}}}},{key:"_addSwitcherEvents",value:function(t){var e=this,n=this.setting("switcher"),i=Array.isArray(t)?t:[t||"click"],o=["input","textarea"],r=["focus","mouseover"];if(this.domEvent.offAll("switcher"),-1===i.indexOf("none")&&n){var s=n.tagName.toLowerCase();i.forEach(function(t){e.domEvent.on(n,t,function(){-1!==o.indexOf(s)||-1!==r.indexOf(t)?e.open():e.toggle()},"switcher")})}}},{key:"_getSwitcherText",value:function(){var t=this._currentDate,e=this.text("months"),n=this.text("caseMonths");return t.day+" "+(n||e)[t.month]+" "+t.year}},{key:"_updateSwitcher",value:function(){var t=this.setting("switcher"),e=this._getSwitcherText();if(t){var n=t.tagName.toLowerCase();"input"===n||"textarea"===n?t.value=e:t.innerHTML=e}}}],[{key:"extend",value:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}}]),o}();T.version="0.10.0";var j={};T.addLocale=function(t,e){j[t]=e},T.getLocales=function(){return Object.keys(j)},T.prototype.text=function(t){return j[this.setting("locale")][t]};var N={};T.addHolidays=function(t,e){N[t]=e},T.prototype.getHoliday=function(t,e,n){var i=this.params.locale;return N[i]&&N[i][n]?N[i][n][t+"-"+(e+1)]:void 0};var Y=function(){function t(){r(this,t)}return e(t,[{key:"init",value:function(){this._buffer=[]}},{key:"on",value:function(t,e,n,i){return t&&e&&n&&(t.addEventListener(e,n,!1),this._buffer.push({elem:t,type:e,callback:n,ns:i})),this}},{key:"off",value:function(t,e,n,i){for(var o=0;o<this._buffer.length;o++){var r=this._buffer[o];r&&r.elem===t&&r.callback===n&&r.type===e&&r.ns===i&&(t.removeEventListener(e,n,!1),this._buffer.splice(o,1),o--)}return this}},{key:"offAll",value:function(t){for(var e=0;e<this._buffer.length;e++){var n=this._buffer[e];t?t===n.ns&&(n.elem.removeEventListener(n.type,n.callback,!1),this._buffer.splice(e,1),e--):n.elem.removeEventListener(n.type,n.callback,!1)}return t||(this._buffer=[]),this}},{key:"destroy",value:function(){this.offAll(),delete this._buffer}}]),t}(),L=Array.isArray,I=Object.prototype.toString,P={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},z=/[&<>"'/]/g,W={noClosingTag:["img","input","br","embed","source","link","meta","area","command","base","col","param","wbr","hr","keygen"],ignoredKeys:["b","e","m","c","t","cl","class"],isPlainObj:function(t){return"[object Object]"===I.call(t)},build:function(t){if(null==t)return"";var e=[];if(this.isPlainObj(t))return this.tag(t);if(L(t)){for(var n=0,i=t.length;n<i;n++)e.push(this.build(t[n]));return e.join("")}return""+t},tag:function(t){var e=t.t||"div",n="<"+e+this.attrs(t);return-1!==this.noClosingTag.indexOf(e)?n+"/>":(n+=">",t.c&&(n+=this.build(t.c)),n+="</"+e+">")},attrs:function(t){var e,n,i=t.b,o=t.e,r=t.m,s=[],a=[];if(i||o){if(i=i||this._currentBlock,o?s.push(this.elem(i,o)):s.push(this.block(i)),this.isPlainObj(r)){for(n in r)r.hasOwnProperty(n)&&s.push(this.elem(i,o,n,r[n]));s.sort();for(var l=0,u=s.length;l<u;l++)s[l]!==s[l-1]&&a.push(s[l])}else a=s;e=this.attr("class",a),this._currentBlock=i}else e=(a=t.cl||t.class)?this.attr("class",a):"";for(n in t)t.hasOwnProperty(n)&&-1===this.ignoredKeys.indexOf(n)&&(e+=this.attr(n,t[n]));return e},attr:function(t,e){return null==e||!1===e?"":" "+t+'="'+function(t){return t.replace(z,function(t){return P[t]})}(L(e)?e.join(" "):""+e)+'"'},block:function(t,e,n){return t+this.mod(e,n)},elem:function(t,e,n,i){return t+(e?"__"+e:"")+this.mod(n,i)},mod:function(t,e){return!1===e||null==e?"":"_"+t+(""===e||!0===e?"":"_"+e)},reset:function(){return this._currentBlock="",this}};
/*!
   * jstohtml
   * © 2018 Denis Seleznev
   * License: MIT
   *
   * https://github.com/hcodes/jstohtml/
  */function B(t){return W.reset().build(t)}var q=function(){function t(){r(this,t)}return e(t,[{key:"get",value:function(t){return B(this[t]())}},{key:"days",value:function(){for(var t=[],e=0;e<=11;e++)t.push(this.month(e,this.parent._currentDate.year));return t}},{key:"dayNames",value:function(){for(var t=this.parent.text("firstWeekday")||0,e={first:t,last:t?t-1:6},n=t,i=0;i<7;i++)e[n]=i,6<++n&&(n=0);return e}},{key:"month",value:function(t,e){for(var n=new Date(e,t,1,12,0,0,0),i=this.parent,o={weekday:n.getDay(),min:i.setting("min"),max:i.setting("max"),dayNames:this.dayNames()},r=this._getTs(o.min),s=this._getTs(o.max),a=this._todayAt12(),l=this._monthFirstRow(o,t,e),u=this._daysMonth(o,t,e,l),h=1;n.getMonth()===t;n.setDate(++h)){var c="",f=+n,d={},y=n.getDay(),m=i.getHoliday(h,t,e);0===y||6===y?d.holiday=!0:d.workday=!0,0===m?d.nonholiday=!0:1===m&&(d.highday=!0),this._isSelected(i._val,h,t,e)&&(d.selected=!0),a===f&&(d.now=!0,c=i.text("today")),(r&&f<r||s&&s<f)&&(d.minmax=!0);var v=i.title.get(E(e,t,h));v&&(d["has-title"]=!0,d["title-color"]=v.color||"default"),y===o.dayNames.first&&(l={t:"tr",c:[]},u.c[1].c.push(l)),l.c.push({t:"td",e:"day",m:d,title:c,"data-month":t,"data-day":h,c:h})}return u}},{key:"_todayAt12",value:function(){var t=new Date;return t.setHours(12,0,0,0),t.getTime()}},{key:"_monthFirstRow",value:function(t,e,n){var i=t.dayNames[t.weekday];return{t:"tr",c:[t.weekday!==t.dayNames.first?{t:"td",colspan:i,e:"empty",c:i<3?"":this._getTitleMonth(t.min,t.max,e,n)}:""]}}},{key:"_daysMonth",value:function(t,e,n,i){var o=t.dayNames[t.weekday];return{b:this.parent._name,e:"days-month",c:[o<3?this._getTitleMonth(t.min,t.max,e,n):"",{t:"table",e:"days-table",c:[i]}]}}},{key:"years",value:function(){for(var t=this.parent.params,e=[{b:this.parent._name,e:"year-selector",c:{e:"year-selector-i"}}],n=t.startYear;n<=t.endYear;n++)e.push({b:this.parent._name,e:"year","data-year":n,c:n});return e}},{key:"months",value:function(){var n=this,i=[{b:this.parent._name,e:"month-selector",c:{e:"month-selector-i"}}];return this.parent.text("months").forEach(function(t,e){i.push({b:n.parent._name,e:"month","data-month":e,c:t})}),i}},{key:"main",value:function(){var t=this.parent,i=t.text("dayNames")||[],o=[],r=t.text("firstWeekday")||0;return t.text("shortDayNames").forEach(function(t,e,n){o.push({e:"short-daynames-cell",m:{n:r},title:i[r]||n[r],c:n[r]}),6<++r&&(r=0)},this),[{b:this.parent._name,e:"container",c:[{e:"days-i",c:[{b:this.parent._name,e:"short-daynames",c:o},{e:"days",c:{e:"days-container",c:this.days()}}]},{e:"months",c:this.months()},{e:"years",c:{e:"years-container",c:this.years()}}]}]}},{key:"_isSelected",value:function(t,e,n,i){return e===t.day&&n===t.month&&i===t.year}},{key:"_getTitleMonth",value:function(t,e,n,i){function o(t){return parseInt(""+t.year+k(t.month),10)}var r=o(t),s=o(e),a={},l=parseInt(""+i+k(n),10);return(r&&l<r||s&&s<l)&&(a.minmax=!0),{e:"days-title-month",m:a,c:this.parent.text("months")[n]}}},{key:"_getTs",value:function(t){return t.year?new Date(t.year,t.month,t.day,12,0,0,0).getTime():null}}]),t}(),F=function(){function t(){r(this,t)}return e(t,[{key:"init",value:function(){this._buffer=[]}},{key:"set",value:function(t,e,n){var i=this,o=setTimeout(function(){t(),i.clear(o)},e);return this._buffer.push({id:o,ns:n}),o}},{key:"clear",value:function(n){var i=-1;return this._buffer&&(this._buffer.some(function(t,e){return t.id===n&&(i=e,!0)}),0<=i&&(clearTimeout(this._buffer[i].id),this._buffer.splice(i,1))),this}},{key:"clearAll",value:function(e){var t=this._buffer,n=[],i=Array.isArray(e)?e:[e];return t.forEach(function(t){e?-1!==i.indexOf(t.ns)?clearTimeout(t.id):n.push(t):clearTimeout(t.id)}),this._buffer=e?n:[],this}},{key:"destroy",value:function(){this.clearAll(),delete this._buffer}}]),t}(),K=function(){function t(){r(this,t)}return e(t,[{key:"init",value:function(t){this._title={},this.set(t.title)}},{key:"get",value:function(t){var e=w(t);return e?this._title[e]:null}},{key:"set",value:function(t){var e=this;Array.isArray(t)?t.forEach(function(t){return e._set(t)}):function(t){return"[object Object]"===Object.prototype.toString.call(t)}(t)&&this._set(t)}},{key:"_set",value:function(t){var e=w(t.date),n=this.parent;if(e&&(this._title[e]={text:t.text,color:t.color},n._isInited)){var i=n._findDayByDate(M(t.date));i&&n.setMod(i,"has-title").setMod(i,"title-color",t.color)}}},{key:"remove",value:function(t){var e=this;Array.isArray(t)?t.forEach(function(t){return e._remove(t)}):this._remove(t)}},{key:"_remove",value:function(t){var e=this.parent,n=w(t);if(n&&(delete this._title[n],e._isInited)){var i=e._findDayByDate(M(t));i&&e.delMod(i,"has-title").delMod(i,"title-color")}}},{key:"removeAll",value:function(){var t=this.parent;if(this._title={},t._isInited){var e=t.findElemAll("day","has-title");if(e)for(var n=0;n<e.length;n++)t.delMod(e[n],"has-title").delMod(e[n],"title-color")}}},{key:"destroy",value:function(){delete this._title}}]),t}(),R=function(){function t(){r(this,t)}return e(t,[{key:"show",value:function(t,e){this._create(),e=e||{};var n=this.parent,i=this._dom;n.setMod(i,"theme",n.setting("theme")).setMod(i,"visible").setMod(i,"color",e.color||"default"),n.findElemContext(i,"tooltip-text").innerHTML=B({b:this.parent._name,e:"tooltip-row",c:e.text});var o=d(t);y(i,{left:o.left-(i.offsetWidth-t.offsetWidth)/2,top:o.top-i.offsetHeight-5}),this._isOpened=!0}},{key:"hide",value:function(){this._isOpened&&(this.parent.delMod(this._dom,"visible"),this._isOpened=!1)}},{key:"_create",value:function(){if(!this._dom){var t=document.createElement("div"),e=this.parent,n=e._name;t.classList.add(e.e("tooltip")),t.innerHTML=B([{b:n,e:"tooltip-text"},{b:n,e:"tooltip-tail"}]),document.body.appendChild(t),this._dom=t}}},{key:"destroy",value:function(){this._dom&&(this.hide(),document.body.removeChild(this._dom),delete this._dom)}}]),t}(),$=[];function X(t){return t.name[0].toLowerCase()+t.name.substr(1)}return T.extend(T.prototype,{_initExtensions:function(){var n=this;$.forEach(function(t){var e=new t;((e.parent=n)[X(t)]=e).init&&e.init(n.params,n._dom)})},_destroyExtensions:function(){var n=this;$.forEach(function(t){var e=X(t);n[e].destroy&&n[e].destroy(),delete n[e]},this)}}),T.addExtension=function(t){Array.isArray(t)?$=$.concat(t):$.push(t)},T.addExtension([Y,q,F,K,R]),T});